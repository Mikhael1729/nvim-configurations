import React, { FC, useContext, useState } from "react";
import { Tooltip, IconButton } from "@material-ui/core";
import { makeStyles, Theme, createStyles } from "@material-ui/core/styles"
import { FilterList as FilterListIcon, Search as SearchIcon, Print as PrintIcon } from "@material-ui/icons";
import DateRange from "./date-range";
import Report from "./report";
import DateHelper from "helpers/date-helper";

const useStyles = makeStyles((theme: Theme) =>
  createStyles({
    toolbar: {
      display: "flex",
      width: "100%",
      flexDirection: "row",
      [theme.breakpoints.down("lg")]: {
        flexDirection: "column",
      },
      [theme.breakpoints.up("lg")]: {
        flexDirection: "row"
      }
    },
    tableButtons: {
      [theme.breakpoints.down("lg")]: {
        marginTop: 15
      }
    },
  })
)

interface IEnhancedToolbarProps<T> {
  title?: string;
  dateProperty: keyof T;
  data: T[];
  filterData: (data: T[]) => void;
}

function EnhancedToolbar<T>({ dateProperty, data, filterData }: IEnhancedToolbarProps<T>) {
  const [currentStartDate, setCurrentStartDate] = useState(new Date());
  const [currentEndDate, setCurrentEndDate] = useState(new Date());

  const classes = useStyles()

  function onDateChange(startDate: Date, endDate: Date) {
    if(startDate != currentStartDate)
      setCurrentStartDate(startDate);

    if(endDate != currentEndDate)
      setCurrentEndDate(endDate);
  }

  return (
    <div className={classes.toolbar}>
      <DateRange
        filterData={filterData}
        data={data}
        dateProperty={dateProperty}
        onDateChange={onDateChange}
      />
      <div className={classes.tableButtons}>
        <Tooltip title="Buscar">
          <IconButton aria-label="search-button">
            <SearchIcon />
          </IconButton>
        </Tooltip>
        <Report
          data={data}
          startDate={DateHelper.dateToStringFormat(currentStartDate)}
          endDate={DateHelper.dateToStringFormat(currentEndDate)}
        />
        <Tooltip title="Filtros">
          <IconButton aria-label="filter-list">
            <FilterListIcon />
          </IconButton>
        </Tooltip>
      </div>
    </div>
  )
}

EnhancedToolbar.defaultProps = {
  title: "Table"
};

export default EnhancedToolbar;
