import React, { FC, useState } from "react";
import { Typography, Paper, Fab } from "@material-ui/core";
import { TransactionsAndStoreProps } from ".";
import EnhancedTable from "components/enhanced-table";
import IHeadCell from "models/ihead-cell";
import Account from "models/account";
import Transaction from "models/transaction";
import EnhancedToolbar from "components/enhanced-table/enhanced-toolbar";
import AccountSelector from "screens/user-home/account-selector";
import { makeStyles, createStyles, Theme } from "@material-ui/core/styles"
import SwapVertIcon from '@material-ui/icons/SwapVert';
import { navigate } from "gatsby";
import SC from "models/screen-component";
import { RouteComponentProps } from "@reach/router";

const useStyles = makeStyles((theme: Theme) =>
  createStyles({
    root: {
      "& > *": {
        margin: theme.spacing(1),
      },
    },
    extendedIcon: {
      marginRight: theme.spacing(1),
    },
    makeTransactionFab: {
      position: "fixed",
      bottom: theme.spacing(2),
      right: theme.spacing(2),
    },
  })
)

export interface ITransactionsProps extends RouteComponentProps {
  pageContext: { breadcrumbName: string };
}

const Transactions: SC<TransactionsAndStoreProps> = ({ pageContext, accounts }) => {
  const classes = useStyles();
  const [selectedIndex, setSelectedIndex] = useState(0);
  const selectedAccount = accounts[selectedIndex];
  const [filteredTransactions, setFilterdTransactions] = useState(selectedAccount.accountTransactions);

  const transactions = selectedAccount.accountTransactions;
  const headers: IHeadCell<Transaction>[] = Transaction.computeHeadCells();

  function onMakeTransaction() {
    navigate('/transacciones/realizar-transferencia');
  }

  return (
    <>
      <Typography variant="h3">Transacciones</Typography>

      <br />

      <AccountSelector
        accounts={accounts}
        selectedIndex={selectedIndex}
        onAccount={(account: Account, index: number) => setSelectedIndex(index)}
      />

      <br />

      <EnhancedTable
        TableContainerProps={{ component: Paper } as any}
        rows={filteredTransactions}
        headerCells={headers}
        dateProperty="dateTime"
        defaultOrderByPropertyName="accountId"
        toolbar={
          <EnhancedToolbar
            dateProperty="dateTime"
            data={transactions}
            filteredData={filteredTransactions}
            filterData={setFilterdTransactions}
          />
        }
      />

      <Fab variant="extended" color="primary" className={classes.makeTransactionFab} onClick={onMakeTransaction}>
        <SwapVertIcon className={classes.extendedIcon} />
        Realizar transacci√≥n
      </Fab>
    </>
  )
}

Transactions.routeName = "/transacciones";

export default Transactions;
