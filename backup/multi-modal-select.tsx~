import React, { FC, useState, ReactElement, ReactNode } from "react";
import { RadioGroup, FormControlLabel, Radio } from "@material-ui/core";
import ConfirmationDialog from "components/confirmation-dialog";

export interface IMultiModalSelect<T> {
  title: string;
  data: Array<T>;
  renderItem: (element: T) => ReactElement;
  onClose: (element?: T) => void;
  selected: T;
  open?: boolean;
  children?: ReactNode;
}

function MultiModalSelect<T>({ data, title, onClose, renderItem, selected, open, children }: IMultiModalSelect<T>) {
  const [value, setValue] = useState(selected);

  React.useEffect(() => {
    if (!open) {
      setValue(selected)
    }
  }, [selected, open]);

  const handleCancel = () => {
    onClose();
  };

  const handleOk = () => {
    onClose(value);
  };

  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    const currentValue = (event.target as HTMLInputElement).value;
    setValue(JSON.parse(currentValue));
  };

  return (
    <>
      <ConfirmationDialog
        title={title}
        open={open}
        onClose={handleCancel}
        onOk={handleOk}
      >
        {children}

        <br />

        <RadioGroup
          aria-label="ringtone"
          name="ringtone"
          value={JSON.stringify(value)}
          onChange={handleChange}
        >
          {data.map((option: T, index: number) => (
            <FormControlLabel
              key={index}
              value={JSON.stringify(option)}
              control={<Radio />}
              label={renderItem(option)}
            />
          ))}
        </RadioGroup>
      </ConfirmationDialog>
    </>
  )
}

export default MultiModalSelect;

