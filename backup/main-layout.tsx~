import React, { SFC, useState } from "react"
import { makeStyles, createStyles } from "@material-ui/core/styles"
import AppBar from "./app-bar/app-bar"
import Toolbar from "./toolbar/toolbar"
import Content from "./content/";
import {
  CssBaseline,
  MuiThemeProvider,
  createMuiTheme,
  Typography,
  responsiveFontSizes,
} from "@material-ui/core"
import { blue } from "@material-ui/core/colors"
import Breadcrumbs from "./breadcrumbs/breadcrumbs"
import LoginLayout from "../login-layout"
import { DorabankStateProvider } from "../../store";

const useStyles = makeStyles(
  createStyles({
    root: {
      display: "flex",
    },
  })
)

const drawerWidth = 240
export const MainLayoutContext = React.createContext({
  drawerWidth,
  mobileOpen: false,
  handleDrawerTogle: () => {},
})

// Personalize the theme for the app.
let theme = createMuiTheme({
  palette: {
    primary: {
      main: blue[700],
    },
    background: {
      default: "#FFFFFF",
    },
    text: {

    }
  },
})

theme = responsiveFontSizes(theme)

interface IMainLayoutProps {
  children?: React.ReactNode
  pageContext?: any
  location?: any
}

const MainLayout: SFC<IMainLayoutProps> = ({ children, pageContext, location }) => {
  const classes = useStyles()
  const [mobileOpen, setMobileOpen] = useState(false)

  function handleDrawerTogle() {
    setMobileOpen(!mobileOpen)
  }

  function computePage() {
    if (pageContext.layout === "404") return <div>{children}</div>

    if (pageContext.layout === "login")
      return <LoginLayout>{children}</LoginLayout>

    return (
      <DorabankStateProvider>
        <MainLayoutContext.Provider
          value={{ drawerWidth, mobileOpen, handleDrawerTogle }}
        >
          <div className={classes.root}>
            <CssBaseline />
            <AppBar />
            <Toolbar />
            <Content>{children}</Content>
          </div>
        </MainLayoutContext.Provider>
      </DorabankStateProvider>
    )
  }

  return <MuiThemeProvider theme={theme}>{computePage()}</MuiThemeProvider>
}

export default MainLayout
