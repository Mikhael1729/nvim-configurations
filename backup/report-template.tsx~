import React, { FC, ReactNode } from "react";
import { makeStyles, Theme, withStyles } from "@material-ui/core/styles";
import { Typography } from "@material-ui/core";
import { useStaticQuery, graphql } from "gatsby";
import Img from "gatsby-image"
import DateHelper from "helpers/date-helper";
import InfoTable from "components/info-table";
import InfoItem from "components/info-table/info-item";
import {ReportTemplateProps} from ".";

const useStyles = makeStyles((theme: Theme) => ({
  headerSection: {
    display: "flex",
    flexDirection: "row",
    alignItems: "center",
    marginBottom: theme.spacing(3)
  },
  brandImageTitle: {
    display: "flex",
    flexDirection: "row",
    alignItems: "center",
    flexGrow: 1,
  },
  brandTitle: {
    marginLeft: theme.spacing(2)
  },
  meta: {
    marginBottom: theme.spacing(3)
  },
  content: {

  },
 table: {
    minWidth: 650,
  },
}))

function loadDorabankIcon() {
  const data = useStaticQuery(graphql`
    query GetDorabankIcon {
      file(absolutePath: { regex: "/icon.png/" }) {
        childImageSharp {
          fixed(width: 40, height: 40) {
            ...GatsbyImageSharpFixed
          }
        }
      }
    }
  `);

  return data;
}

interface IReportTemplate extends ReportTemplateProps {
  children: ReactNode;
}

const ReportTemplate: FC<IReportTemplate> = ({ children, fullName }) => {
  const classes = useStyles();
  const dorabankImage = loadDorabankIcon();
  const formattedCurrentDate: string = DateHelper.convertToSpanishFullDate(new Date(Date.now()));

  return (
    <div>
      <div className={classes.headerSection}>
        <div className={classes.brandImageTitle}>
          <Img fixed={dorabankImage.file.childImageSharp.fixed} />
          <Typography variant="h6" className={classes.brandTitle}>
            Dorabank
          </Typography>
        </div>
      </div>

      <div className={classes.meta}>
        <InfoTable>
          <InfoItem tag="Nombre" value={fullName} />
          <InfoItem tag="Fecha de solicitud" value={formattedCurrentDate} />
        </InfoTable>
      </div>
      <div className={classes.content}>{children}</div>
    </div>
  )
}

export default ReportTemplate;
