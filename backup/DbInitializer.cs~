using CoreApi.Models;
using System.Linq;
using System;

namespace CoreApi.Data
{
  public static class DbInitializer
  {
    public static void Initialize(DoraBankDbContext context)
    {
      context.Database.EnsureCreated();

      var databaseHasBeenSeeded = context.Users.Any();
      if(databaseHasBeenSeeded)
        return;

      // Create and save roles in the database.
      var roles = new Role[]
      {
        new Role
        {
          Name = "Hacker",
          Description = "Has access to do anything in the database",
          CreationDate = DateTime.Now,
          Active = true,
        }
      };

      foreach(Role role in roles)
        context.Roles.Add(role);

      context.SaveChanges();

      // Create users and save them in the database.
      var users = new User[]
      {
        new User
        {
          Names = "Mikhael",
          Surnames = "Santos Fern√°ndez",
          IdCard = "40227150253",
          Username = "Mikhael1729",
          Password = "3QuDRJ.f9)",
          Birthdate = DateTime.Parse("10/24/1998"),
          City = "Santo Domingo",
          Region = "Distrito Nacional",
          Neighborhood = "Palma Real",
          Street = "Calle Mirador",
          HouseNumber = 89,
          Gender = Gender.Male,
          Status = UserStatus.Active
        }
      };

      foreach(User user in users)
        context.Users.Add(user);

      context.SaveChanges();


      // Create and save user roles in the database.
      var userRoles = new UserRole[]
      {
        new UserRole
        {
          UserId = 1,
          RoleId = 1,
          CreationDate = DateTime.Now,
        }
      };

      foreach(UserRole userRole in userRoles)
        context.UserRoles.Add(userRole);

      context.SaveChanges();

      // Create account of users and save them into the database.
      var accounts = new Account[]
      {
        new Account
        {
          UserId = 1,
          AccountNumber = "1403984843029",
          Type = AccountType.SavingsAccount,
          Status = AccountStatus.Active,
          AvailableBalance = 68000.34m,
          AmountInTransit = 0m,
          CurrentBalance = 680000.32m,
        }
      };

      foreach(Account account in accounts)
        context.Accounts.Add(account);

      context.SaveChanges();
    }
  }
}
